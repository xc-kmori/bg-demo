# タスク管理システム - システム構成図

## 1. 全体アーキテクチャ図

```mermaid
graph TB
    subgraph "クライアント層"
        A[Webブラウザ<br/>JavaScript SPA]
    end
    
    subgraph "アプリケーション層"
        B[Flask Webサーバー<br/>Port:5000]
        C[認証モジュール<br/>JWT Manager]
        D[APIルーター<br/>Blueprints]
    end
    
    subgraph "ビジネスロジック層"
        E[タスク管理<br/>Service Layer]
        F[カテゴリ管理<br/>Service Layer]
        G[ユーザー管理<br/>Service Layer]
    end
    
    subgraph "データアクセス層"
        H[SQLAlchemy ORM<br/>Models & Database]
    end
    
    subgraph "データ層"
        I[(SQLite Database<br/>task_manager.db)]
    end
    
    A -.->|HTTPS/HTTP<br/>JSON API| B
    B --> C
    B --> D
    D --> E
    D --> F
    D --> G
    E --> H
    F --> H
    G --> H
    H --> I
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#e8f5e8
    style F fill:#e8f5e8
    style G fill:#e8f5e8
    style H fill:#fff9c4
    style I fill:#fce4ec
```

## 2. ネットワーク構成図

```mermaid
graph LR
    subgraph "クライアント"
        A[Webブラウザ<br/>localhost:8080]
    end
    
    subgraph "サーバー"
        B[Flask Server<br/>localhost:5000]
        C[Static Files<br/>HTML/CSS/JS]
    end
    
    A -->|HTTP GET| C
    A -.->|API Calls<br/>JSON| B
    B -.->|JSON Response| A
    
    style A fill:#e3f2fd
    style B fill:#e8f5e8
    style C fill:#fff3e0
```

## 3. フロントエンド構成図

```mermaid
graph TD
    A[index.html<br/>メインページ] --> B[app.js<br/>アプリケーション制御]
    A --> C[styles.css<br/>スタイリング]
    
    B --> D[Auth Module<br/>認証管理]
    B --> E[Dashboard Module<br/>ダッシュボード]
    B --> F[Tasks Module<br/>タスク管理]
    B --> G[Categories Module<br/>カテゴリ管理]
    B --> H[Utils Module<br/>共通機能]
    
    D --> I[APIClient<br/>通信層]
    E --> I
    F --> I
    G --> I
    
    I --> J[AppState<br/>状態管理]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style I fill:#f3e5f5
    style J fill:#fff9c4
```

## 4. バックエンド構成図

```mermaid
graph TD
    A[run.py<br/>エントリーポイント] --> B[app.py<br/>Application Factory]
    
    B --> C[Blueprint Registration]
    B --> D[Database Initialization]
    B --> E[JWT Configuration]
    B --> F[CORS Configuration]
    
    C --> G[auth.py<br/>認証API]
    C --> H[tasks.py<br/>タスクAPI]
    C --> I[categories.py<br/>カテゴリAPI]
    
    G --> J[models.py<br/>User Model]
    H --> K[models.py<br/>Task Model]
    I --> L[models.py<br/>Category Model]
    
    J --> M[database.py<br/>DB Config]
    K --> M
    L --> M
    
    M --> N[(SQLite DB)]
    
    subgraph "Utils Layer"
        O[validators.py<br/>バリデーション]
        P[decorators.py<br/>デコレーター]
        Q[logger.py<br/>ログ機能]
    end
    
    G --> O
    H --> O
    I --> O
    
    G --> P
    H --> P
    I --> P
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style M fill:#fff9c4
    style N fill:#fce4ec
```

## 5. データフロー図

```mermaid
flowchart TD
    A[ユーザー操作<br/>Frontend] --> B{認証状態}
    
    B -->|認証済み| C[API Request<br/>with JWT Token]
    B -->|未認証| D[Login/Register<br/>Screen]
    
    C --> E[Flask Router<br/>Endpoint]
    E --> F[JWT Token<br/>Validation]
    F --> G[Business Logic<br/>Processing]
    
    G --> H[Database<br/>Operation]
    H --> I[(SQLite)]
    
    I --> J[Response Data]
    J --> K[JSON Response]
    K --> L[Frontend<br/>State Update]
    L --> M[UI Rendering]
    
    D --> N[Auth API<br/>Call]
    N --> O[Token Generation]
    O --> P[Authenticated<br/>State]
    P --> C
    
    style A fill:#e3f2fd
    style E fill:#e8f5e8
    style G fill:#fff3e0
    style I fill:#fce4ec
    style M fill:#e1f5fe
```

## 6. セキュリティアーキテクチャ

```mermaid
graph TD
    A[Client Request] --> B{CORS Check}
    B -->|Allow| C[JWT Token<br/>Validation]
    B -->|Deny| D[CORS Error]
    
    C -->|Valid| E[User Identity<br/>Extraction]
    C -->|Invalid| F[401 Unauthorized]
    
    E --> G[Authorization<br/>Check]
    G -->|Authorized| H[Business Logic]
    G -->|Unauthorized| I[403 Forbidden]
    
    H --> J[Data Access<br/>with User Context]
    J --> K[SQL Query<br/>with User Filter]
    K --> L[Response]
    
    subgraph "Security Layers"
        M[Password Hashing<br/>Werkzeug PBKDF2]
        N[Input Validation<br/>Custom Validators]
        O[SQL Injection<br/>Prevention - ORM]
    end
    
    style B fill:#ffcdd2
    style C fill:#fff3e0
    style G fill:#e8f5e8
    style M fill:#fce4ec
    style N fill:#fce4ec
    style O fill:#fce4ec
```

## 7. デプロイメント構成

```mermaid
graph TB
    subgraph "開発環境"
        A[Python venv]
        B[Flask Development Server<br/>localhost:5000]
        C[SQLite File<br/>instance/task_manager.db]
        D[Static Files<br/>frontend/]
    end
    
    subgraph "ファイル構造"
        E[task_manager_api/<br/>Backend Code]
        F[frontend/<br/>Frontend Code]
        G[docs/<br/>Documentation]
        H[logs/<br/>Log Files]
    end
    
    A --> B
    B --> C
    B --> D
    E --> B
    F --> D
    
    style A fill:#e8f5e8
    style B fill:#e1f5fe
    style C fill:#fff9c4
    style D fill:#fff3e0
```

## 8. 外部依存関係

```mermaid
graph LR
    A[Task Manager System] --> B[Flask Framework]
    A --> C[SQLAlchemy ORM]
    A --> D[JWT Library]
    A --> E[Font Awesome]
    
    B --> F[Werkzeug<br/>WSGI Server]
    B --> G[Jinja2<br/>Template Engine]
    
    C --> H[SQLite Driver]
    
    D --> I[PyJWT<br/>Token Handling]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff9c4
    style D fill:#fff3e0
    style E fill:#f3e5f5
```

---

**作成日**: 2024年12月27日  
**バージョン**: 1.0  
**次回更新予定**: システム拡張時